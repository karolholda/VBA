
'===========================
' Funkcja: RefreshAllData
'===========================

Odświeża wszystkie dane w skoroszycie, czeka aż Power Query skończy, 
loguje czas wykonania i zwraca informację, czy refresh się udał. Funkcja bo Boolean

    Private Function RefreshAllData() As Boolean
        On Error GoTo ErrHandler

' zapamiętaj czas startu (do pomiaru długości refreshu)
        Dim t As Double
        t = Timer   
    
        LogInfo "RefreshAllData", "Refresh started", ""
    
' Odśwież wszystkie źródła danych w skoroszycie (Power Query, Connections, PivotCaches itp.)
        ThisWorkbook.RefreshAll
    
' Poczekaj, aż zakończą się zapytania asynchroniczne (kluczowe dla Power Query)
        Application.CalculateUntilAsyncQueriesDone
    
' Log zakończenia z czasem trwania
        LogInfo "RefreshAllData", "Refresh completed", _
                "DurationSec=" & Format(Timer - t, "0.0")
    
' Jeśli dotarliśmy tutaj – wszystko się udało
        RefreshAllData = True
        Exit Function
    
    ErrHandler:
' Obsługa błędu refreshu
        LogError "RefreshAllData", "Refresh failed", _
                 "Err " & Err.Number & ": " & Err.Description
    
        RefreshAllData = False
    End Function
